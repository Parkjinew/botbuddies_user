<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smhrd.botbuddies.mapper.UserMapper">
<select id="selectUser" resultType="com.smhrd.botbuddies.entity.User">
select * from USERS
</select>

<select id="signin" parameterType='String' resultType="com.smhrd.botbuddies.entity.User">
select * from USERS where user_id = #{id} and user_pw = MD5(#{password})
</select>


<select id="favorite" parameterType='String' resultType="com.smhrd.botbuddies.entity.User">
SELECT 
    s.store_name, 
    ANY_VALUE(s.store_seq) AS store_seq, 
    s.category_seq, 
    AVG(r.score) AS AverageRating, 
    COUNT(r.title) AS ReviewCount, 
    ANY_VALUE(mi.img_filename) AS STORE_IMG 
FROM 
    USERS m 
INNER JOIN 
    INTEREST i ON m.user_id = i.user_id 
INNER JOIN 
    STORES s ON i.store_seq = s.store_seq 
LEFT JOIN 
    REVIEWS r ON s.store_seq = r.store_seq 
LEFT JOIN 
    STORE_IMG mi ON s.store_seq = mi.store_seq 
WHERE 
    m.user_id = #{id}
GROUP BY 
    s.store_name, s.category_seq
</select>



</mapper>